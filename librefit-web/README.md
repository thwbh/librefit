# librefit-web

## Developing

Once you've created a project and installed dependencies with `npm install` (or `pnpm install` or `yarn`), start a development server:

```bash
npm run dev

# or start the server and open the app in a new browser tab
npm run dev -- --open

# start server in your local network (useful for mobile devices)
npm run dev -- --host
```

## Building

To create a production version:

```bash
npm run build
```

You can preview the production build with `npm run preview`.

> To deploy your app, you may need to install an [adapter](https://kit.svelte.dev/docs/adapters) for your target environment.

## Dependencies

This project uses SvelteKit with [Skeleton](https://www.skeleton.dev/) as UI framework.

The following files are generated by `librefit-api` and should not be modified manually:

- `src/lib/api/model.js`
- `src/lib/server/api/index.js`

For the right build order, please see the [main description](https://github.com/tohuwabohu-io/librefit/blob/main/README.MD).

## API

By design, SvelteKit utilizes a customized `fetch` function. Each call to the `librefit-service` - or each operation
described in the OpenAPI spec - is encapsulated by the `proxyFetch` function located in `src/lib/server/api/util.js` to
ensure the right method is being used. There is no direct communication from the client side code to the service in the 
components. 

All `fetch` calls will be rerouted by the `+page.server.js` and/or `+server.js`. This approach ensures that the JWT 
cookie is not available in the browser and thus can't be tampered with.

When changing routes in the browser, a hook placed in `src/hooks.server.js` will check the route against a list of
unguarded routes. If the route requires authentication and the JWT cookie has not been set yet, the user will be
redirected to the main page. Please note that the hook assumes each route to be guarded and unguarded routes need to
be manually added to the list of exemptions. Generally, all routes in the `(app)` group are guarded, the ones in the
`(landing)` group should be public accessible.

## Tests

TODO: It is planned to implement [playwright](https://playwright.dev/) component tests in the future.